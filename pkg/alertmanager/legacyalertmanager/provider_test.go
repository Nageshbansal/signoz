package legacyalertmanager

import (
	"encoding/json"
	"fmt"
	"testing"

	"github.com/tidwall/gjson"
	"go.signoz.io/signoz/pkg/types/alertmanagertypes"
)

func TestRandowm(t *testing.T) {
	result := []byte(`{"status":"success","data":[{"labels":{"alertname":"[K8S] Deployment Desired is greater than 0.2","k8s_cluster_name":"mgmt","k8s_namespace_name":"gcp-test","ruleId":"1","ruleSource":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","severity":"warning"},"annotations":{"description":"This alert is fired when the defined metric (current value: 1) crosses the threshold (0.2)","summary":"The rule threshold is set to 0.2, and the observed metric value is 1"},"startsAt":"2025-02-20T13:29:23.708306749Z","endsAt":"2025-02-20T13:42:23.708306749Z","generatorURL":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","status":{"state":"active","silencedBy":null,"inhibitedBy":null},"receivers":["wb-webhooksite"],"fingerprint":"028af2b136b4d5e1"},{"labels":{"alertname":"[K8S] Deployment Desired is greater than 0.2","k8s_cluster_name":"mgmt","k8s_namespace_name":"cicd","ruleId":"1","ruleSource":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","severity":"warning"},"annotations":{"description":"This alert is fired when the defined metric (current value: 1) crosses the threshold (0.2)","summary":"The rule threshold is set to 0.2, and the observed metric value is 1"},"startsAt":"2025-02-20T13:29:23.708306749Z","endsAt":"2025-02-20T13:42:23.708306749Z","generatorURL":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","status":{"state":"active","silencedBy":null,"inhibitedBy":null},"receivers":["wb-webhooksite"],"fingerprint":"10259efb115043cb"},{"labels":{"alertname":"[K8S] Deployment Desired is greater than 0.2","k8s_cluster_name":"mgmt","k8s_namespace_name":"otelgateway","ruleId":"1","ruleSource":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","severity":"warning"},"annotations":{"description":"This alert is fired when the defined metric (current value: 1) crosses the threshold (0.2)","summary":"The rule threshold is set to 0.2, and the observed metric value is 1"},"startsAt":"2025-02-20T13:29:23.708306749Z","endsAt":"2025-02-20T13:42:23.708306749Z","generatorURL":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","status":{"state":"active","silencedBy":null,"inhibitedBy":null},"receivers":["wb-webhooksite"],"fingerprint":"13e000805488a66c"},{"labels":{"alertname":"[K8S] Deployment Desired is greater than 0.2","k8s_cluster_name":"mgmt","k8s_namespace_name":"observability","ruleId":"1","ruleSource":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","severity":"warning"},"annotations":{"description":"This alert is fired when the defined metric (current value: 1) crosses the threshold (0.2)","summary":"The rule threshold is set to 0.2, and the observed metric value is 1"},"startsAt":"2025-02-20T13:29:23.708306749Z","endsAt":"2025-02-20T13:42:23.708306749Z","generatorURL":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","status":{"state":"active","silencedBy":null,"inhibitedBy":null},"receivers":["wb-webhooksite"],"fingerprint":"1e4bdd55ebec7d6b"},{"labels":{"alertname":"[K8S] Deployment Desired is greater than 0.2","k8s_cluster_name":"mgmt","k8s_namespace_name":"generator","ruleId":"1","ruleSource":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","severity":"warning"},"annotations":{"description":"This alert is fired when the defined metric (current value: 1) crosses the threshold (0.2)","summary":"The rule threshold is set to 0.2, and the observed metric value is 1"},"startsAt":"2025-02-20T13:29:23.708306749Z","endsAt":"2025-02-20T13:42:23.708306749Z","generatorURL":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","status":{"state":"active","silencedBy":null,"inhibitedBy":null},"receivers":["wb-webhooksite"],"fingerprint":"3daea567650357d7"},{"labels":{"alertname":"[K8S] Deployment Desired is greater than 0.2","k8s_cluster_name":"mgmt","k8s_namespace_name":"ingress","ruleId":"1","ruleSource":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","severity":"warning"},"annotations":{"description":"This alert is fired when the defined metric (current value: 1) crosses the threshold (0.2)","summary":"The rule threshold is set to 0.2, and the observed metric value is 1"},"startsAt":"2025-02-20T13:29:23.708306749Z","endsAt":"2025-02-20T13:42:23.708306749Z","generatorURL":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","status":{"state":"active","silencedBy":null,"inhibitedBy":null},"receivers":["wb-webhooksite"],"fingerprint":"3de690485e7a04c5"},{"labels":{"alertname":"[K8S] Deployment Desired is greater than 0.2","k8s_cluster_name":"mgmt","k8s_namespace_name":"testing","ruleId":"1","ruleSource":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","severity":"warning"},"annotations":{"description":"This alert is fired when the defined metric (current value: 1) crosses the threshold (0.2)","summary":"The rule threshold is set to 0.2, and the observed metric value is 1"},"startsAt":"2025-02-20T13:29:23.708306749Z","endsAt":"2025-02-20T13:42:23.708306749Z","generatorURL":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","status":{"state":"active","silencedBy":null,"inhibitedBy":null},"receivers":["wb-webhooksite"],"fingerprint":"59b422f11a410fb8"},{"labels":{"alertname":"[K8S] Deployment Desired is greater than 0.2","k8s_cluster_name":"mgmt","k8s_namespace_name":"saas-system","ruleId":"1","ruleSource":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","severity":"warning"},"annotations":{"description":"This alert is fired when the defined metric (current value: 1) crosses the threshold (0.2)","summary":"The rule threshold is set to 0.2, and the observed metric value is 1"},"startsAt":"2025-02-20T13:29:23.708306749Z","endsAt":"2025-02-20T13:42:23.708306749Z","generatorURL":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","status":{"state":"active","silencedBy":null,"inhibitedBy":null},"receivers":["wb-webhooksite"],"fingerprint":"9464f2f142c4d01a"},{"labels":{"alertname":"[K8S] Deployment Desired is greater than 0.2","k8s_cluster_name":"mgmt","k8s_namespace_name":"security","ruleId":"1","ruleSource":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","severity":"warning"},"annotations":{"description":"This alert is fired when the defined metric (current value: 1) crosses the threshold (0.2)","summary":"The rule threshold is set to 0.2, and the observed metric value is 1"},"startsAt":"2025-02-20T13:29:23.708306749Z","endsAt":"2025-02-20T13:42:23.708306749Z","generatorURL":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","status":{"state":"active","silencedBy":null,"inhibitedBy":null},"receivers":["wb-webhooksite"],"fingerprint":"c5969abf2d1feeb8"},{"labels":{"alertname":"[K8S] Deployment Desired is greater than 0.2","k8s_cluster_name":"mgmt","k8s_namespace_name":"kube-system","ruleId":"1","ruleSource":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","severity":"warning"},"annotations":{"description":"This alert is fired when the defined metric (current value: 1.6666666666666667) crosses the threshold (0.2)","summary":"The rule threshold is set to 0.2, and the observed metric value is 1.6666666666666667"},"startsAt":"2025-02-20T13:29:23.708306749Z","endsAt":"2025-02-20T13:42:23.708306749Z","generatorURL":"https://vibhu.us.staging.signoz.cloud/alerts/edit?ruleId=1","status":{"state":"active","silencedBy":null,"inhibitedBy":null},"receivers":["wb-webhooksite"],"fingerprint":"dd066f60d656f573"}]}`)

	var alerts alertmanagertypes.DeprecatedGettableAlerts
	fmt.Println(gjson.GetBytes(result, "data").Raw)
	if err := json.Unmarshal([]byte(gjson.GetBytes(result, "data").Raw), &alerts); err != nil {
		t.Fatal(err)
	}

	fmt.Println(alerts)

}
